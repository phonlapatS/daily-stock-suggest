# üìã ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Prompt: Predict N+1 System Architecture

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:** 2026-02-13  
**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå prompt ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ Prompt ‡∏´‡∏•‡∏±‡∏Å

### ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
1. **Module Separation**: ‡πÅ‡∏¢‡∏Å Core Pipeline ‡∏Å‡∏±‡∏ö Pattern/Signal Logic ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
2. **Always Predict**: ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå
3. **Bucketed Pattern Signature**: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ exact match ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ bucket (SMALL/MEDIUM/LARGE)
4. **Threshold per Country + Symbol**: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö threshold ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
5. **CSV Output**: `prediction_log.csv` ‡πÅ‡∏•‡∏∞ `evaluation_log.csv`
6. **Simple Features**: OHLCV + feature ‡∏á‡πà‡∏≤‡∏¢‡πÜ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ indicator ‡πÄ‡∏¢‡∏≠‡∏∞)
7. **Strict Criteria**: **Prob > 60% (‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å)**, RRR > 2 (secondary), match_count >= Nmin (30-50)
   - **‡πÄ‡∏ô‡πâ‡∏ô Quality over Quantity**: ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤
   - **‡∏ï‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≠‡∏Å**: ‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏ô‡∏ñ‡πâ‡∏≤ Prob < 60%

---

## ‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß

### 1. Pattern Matching System
- ‚úÖ ‡∏°‡∏µ `core/engines/base_engine.py` ‡∏ó‡∏µ‡πà‡∏ó‡∏≥ pattern matching
- ‚úÖ ‡πÉ‡∏ä‡πâ `+/-` pattern ‡∏à‡∏≤‡∏Å `pct_change` vs `threshold`
- ‚úÖ ‡∏™‡πÅ‡∏Å‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 5000 bars ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ match
- ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì prob, avgWin, avgLoss, RRR

**‡πÅ‡∏ï‡πà:**
- ‚ùå ‡πÉ‡∏ä‡πâ **exact pattern matching** (`++--`) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà **bucketed signature**
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ "Always Predict" ‚Üí ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ pattern match

### 2. Threshold Configuration
- ‚úÖ ‡∏°‡∏µ threshold per country ‡πÉ‡∏ô `config.py` ‡πÅ‡∏•‡∏∞ `backtest.py`
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö dynamic threshold (SD-based) ‡πÅ‡∏•‡∏∞ fixed threshold
- ‚úÖ ‡∏°‡∏µ market floor (min_threshold) ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®

**‡πÅ‡∏ï‡πà:**
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ **symbol-level override** (threshold ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏∏‡πâ‡∏ô)
- ‚ùå Threshold ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö pattern detection ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "bucketing"

### 3. CSV Output
- ‚úÖ ‡∏°‡∏µ `trade_history_*.csv` (‡∏à‡∏≤‡∏Å backtest)
- ‚úÖ ‡∏°‡∏µ `symbol_performance.csv` (‡∏à‡∏≤‡∏Å calculate_metrics)
- ‚úÖ ‡∏°‡∏µ `forecast_tomorrow.csv` (‡∏à‡∏≤‡∏Å main.py)
- ‚úÖ ‡∏°‡∏µ `performance_log.csv` (‡∏à‡∏≤‡∏Å core/performance.py)

**‡πÅ‡∏ï‡πà:**
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ `prediction_log.csv` ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏°‡∏µ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô, ‡∏ó‡∏∏‡∏Å‡∏´‡∏∏‡πâ‡∏ô)
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ `evaluation_log.csv` ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ß‡∏±‡∏î‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á N+1 ‡∏õ‡∏¥‡∏î)

### 4. Features
- ‚úÖ ‡πÉ‡∏ä‡πâ OHLCV + `pct_change`
- ‚úÖ ‡∏°‡∏µ `Range%`, `Body%` (‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)
- ‚úÖ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ indicator ‡πÄ‡∏¢‡∏≠‡∏∞ (‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà ATR, ADX ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏≤‡∏á‡∏ï‡∏•‡∏≤‡∏î)

**‡πÅ‡∏ï‡πà:**
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ `Wick type` classification (UPPER_LONG/LOWER_LONG/BOTH/NONE)
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ `Volume bucket` (LOW/NORMAL/HIGH)

### 5. Criteria
- ‚úÖ ‡∏°‡∏µ Prob% filter (50-60% ‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î)
- ‚úÖ ‡∏°‡∏µ RRR filter (1.2-1.5 ‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î)
- ‚úÖ ‡∏°‡∏µ min_stats filter (15-30 ‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î)

**‡πÅ‡∏ï‡πà:**
- ‚ùå ‡πÄ‡∏Å‡∏ì‡∏ë‡πå Prob% ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ prompt (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô 50-60%, prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ > 60% ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å)
- ‚ùå RRR ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô gatekeeper (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô 1.2-1.5) ‡πÅ‡∏ï‡πà prompt ‡πÄ‡∏ô‡πâ‡∏ô Prob > 60% ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ "Always Predict" ‚Üí ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå

---

## ‚ùå ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ

### 1. Module Separation (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)
**Prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
```
A) Core Prediction Pipeline
   - ‡∏£‡∏±‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
   - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
   - ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏¢‡πà‡∏≠‡∏¢
   - ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ú‡∏•

B) Pattern & Signal Logic
   - ‡∏™‡∏£‡πâ‡∏≤‡∏á signature
   - match history
   - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì prob/RRR
   - ‡∏Ñ‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì
```

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚ùå Logic ‡∏õ‡∏ô‡∏Å‡∏±‡∏ô‡πÉ‡∏ô `backtest.py` (700+ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)
- ‚ùå Pattern matching, threshold calculation, risk management ‡∏õ‡∏ô‡∏Å‡∏±‡∏ô
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ clear boundary ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Core ‡∏Å‡∏±‡∏ö Pattern Logic

### 2. Always Predict
**Prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
- ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏ó‡∏∏‡∏Å‡∏´‡∏∏‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ pattern match ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏•‡∏á `prediction_log.csv`
- ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì BUY/SELL ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå:
  - **Prob > 60% (‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å)** ‚Üí ‡πÄ‡∏ô‡πâ‡∏ô‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤
  - RRR > 2 (secondary filter)
  - match_count >= Nmin (30-50)
  - **‡∏ï‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≠‡∏Å**: ‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏ô‡∏ñ‡πâ‡∏≤ Prob < 60%

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚ùå ‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ pattern match
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ "Always Predict" ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ pattern

### 3. Bucketed Pattern Signature
**Prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
```python
signature = [
  direction_today (UP/DOWN),
  move_bucket (SMALL/MEDIUM/LARGE),  # ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á threshold ‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏ô‡∏±‡πâ‡∏ô
  body_bucket (SMALL/MEDIUM/LARGE),
  wick_type (UPPER_LONG/LOWER_LONG/BOTH/NONE),
  volume_bucket (LOW/NORMAL/HIGH)
]
```

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚ùå ‡πÉ‡∏ä‡πâ exact pattern (`++--`) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà bucketed signature
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ body_bucket, wick_type, volume_bucket

### 4. Symbol-Level Threshold Override
**Prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
```python
country_config = {
  'TH': {'default_threshold': 1.0, ...},
  'US': {'default_threshold': 0.5, ...}
}

symbol_override = {
  'PTT': {'threshold': 1.2},  # Override ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞
  'NVDA': {'threshold': 0.6}
}
```

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚ùå ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà country-level threshold
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ symbol-level override

### 5. Evaluation Log
**Prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:**
- `evaluation_log.csv` ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á N+1 ‡∏õ‡∏¥‡∏î
- ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö `direction_pred` vs `direction_actual`
- ‡∏ß‡∏±‡∏î `hit_direction`, `target_hit`

**‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
- ‚ùå ‡∏°‡∏µ `performance_log.csv` ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà format ‡∏ó‡∏µ‡πà prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
- ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ evaluation workflow ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô

---

## üîç ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Architecture

### Prompt Architecture:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Core Prediction Pipeline          ‚îÇ
‚îÇ   - fetch_and_clean_ohlcv()         ‚îÇ
‚îÇ   - core_run_daily()                 ‚îÇ
‚îÇ   - write_prediction_csv()           ‚îÇ
‚îÇ   - run_evaluation_after_close()     ‚îÇ
‚îÇ   - write_evaluation_csv()           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ calls
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Pattern & Signal Logic             ‚îÇ
‚îÇ   - build_signature()                ‚îÇ
‚îÇ   - match_history()                 ‚îÇ
‚îÇ   - compute_stats()                 ‚îÇ
‚îÇ   - compute_rrr()                   ‚îÇ
‚îÇ   - decide_signal()                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Current Architecture:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   backtest.py (700+ lines)          ‚îÇ
‚îÇ   - Pattern matching                ‚îÇ
‚îÇ   - Threshold calculation           ‚îÇ
‚îÇ   - Risk management                 ‚îÇ
‚îÇ   - Trade simulation                ‚îÇ
‚îÇ   - CSV output                      ‚îÇ
‚îÇ   (Everything mixed together!)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÑ‡∏´‡∏°?

### ‚úÖ **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°** ‡∏ñ‡πâ‡∏≤:
1. **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô** ‚Üí ‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö tracking ‡πÅ‡∏•‡∏∞ evaluation
2. **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ module separation** ‚Üí ‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö maintainability ‡πÅ‡∏•‡∏∞ testing
3. **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ bucketed signature** ‚Üí ‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö flexibility (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á exact match)
4. **‡πÄ‡∏ô‡πâ‡∏ô Quality over Quantity** ‚Üí Prob > 60% ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å (‡∏ï‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≠‡∏Å)
5. **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ strict criteria** ‚Üí ‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö quality control (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡πá‡∏ï‡∏≤‡∏°)

### ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á** ‡∏ñ‡πâ‡∏≤:
1. **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏à‡∏∞‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å** (Prob > 60%) ‚Üí **‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£** (‡πÄ‡∏ô‡πâ‡∏ô quality)
2. **Bucketed signature ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ match ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ** ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ bucket size ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
3. **Always Predict = ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô** ‚Üí ‡πÉ‡∏ä‡πâ resource ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
4. **RRR > 2 ‡∏≠‡∏≤‡∏à‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ** ‚Üí ‡∏ñ‡πâ‡∏≤ Prob > 60% ‡πÅ‡∏•‡πâ‡∏ß RRR ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á > 2 (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô secondary filter)

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ: ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?

### **‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö: ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô Prob > 60% ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å**

### **Philosophy: Quality over Quantity**
- **Prob > 60%**: ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å ‚Üí ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤
- **‡∏ï‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≠‡∏Å**: ‡πÑ‡∏°‡πà‡πÄ‡∏•‡πà‡∏ô‡∏ñ‡πâ‡∏≤ Prob < 60%
- **RRR > 2**: ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô secondary filter ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô gatekeeper
- **‡πÄ‡∏ô‡πâ‡∏ô Quality**: ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏ï‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥:
1. ‚úÖ **Module Separation**: ‡πÅ‡∏¢‡∏Å Core Pipeline ‡∏Å‡∏±‡∏ö Pattern Logic
2. ‚úÖ **Always Predict**: ‡πÄ‡∏û‡∏¥‡πà‡∏° daily prediction workflow
3. ‚úÖ **Bucketed Signature**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö bucketed approach (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö exact pattern)
4. ‚úÖ **Symbol Override**: ‡πÄ‡∏û‡∏¥‡πà‡∏° symbol-level threshold configuration
5. ‚úÖ **Evaluation Log**: ‡∏™‡∏£‡πâ‡∏≤‡∏á `evaluation_log.csv` ‡∏ï‡∏≤‡∏° format ‡∏ó‡∏µ‡πà prompt ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ:
1. ‚úÖ **Exact Pattern Matching**: ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö bucketed)
2. ‚úÖ **Current Threshold System**: ‡∏î‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° symbol override)
3. ‚úÖ **Current Risk Management**: ‡∏î‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (ATR-based, Trailing Stop)

### ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
1. ‚ö†Ô∏è **Bucketed Signature**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ bucket size ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
2. ‚ö†Ô∏è **Prob > 60% Criteria**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡πÄ‡∏ô‡πâ‡∏ô quality)
3. ‚ö†Ô∏è **RRR Filter**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ RRR > 2 ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Prob > 60% ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
4. ‚ö†Ô∏è **Always Predict**: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ performance ‡πÅ‡∏•‡∏∞ resource usage ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£

---

## üìù Next Steps

### **Priority 1: Prob > 60% Filter (Quality First)**
- ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå Prob% ‡∏à‡∏≤‡∏Å 50-60% ‚Üí **> 60% ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏´‡∏•‡∏±‡∏Å**
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡πÄ‡∏ô‡πâ‡∏ô quality over quantity)
- RRR ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô secondary filter ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô gatekeeper

### **Priority 2: Module Separation**
- ‡πÅ‡∏¢‡∏Å `backtest.py` ‡πÄ‡∏õ‡πá‡∏ô Core Pipeline + Pattern Logic
- ‡∏™‡∏£‡πâ‡∏≤‡∏á clear interface ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á modules

### **Priority 3: Always Predict**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° daily prediction workflow
- ‡∏™‡∏£‡πâ‡∏≤‡∏á `prediction_log.csv` format
- **‡∏ï‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≠‡∏Å**: Prob < 60% ‚Üí NO-TRADE/WATCHLIST

### **Priority 4: Bucketed Signature**
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö bucketed approach
- ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö exact pattern matching

### **Priority 5: Evaluation System**
- ‡∏™‡∏£‡πâ‡∏≤‡∏á `evaluation_log.csv` format
- ‡πÄ‡∏û‡∏¥‡πà‡∏° evaluation workflow

### **Priority 6: Symbol Override**
- ‡πÄ‡∏û‡∏¥‡πà‡∏° symbol-level threshold configuration
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö override mechanism

---

## üîó Related Documents

- [PATTERN_DETECTION_LOGIC.md](PATTERN_DETECTION_LOGIC.md) - Current pattern detection
- [STRATEGY_TABLE_BY_COUNTRY.md](STRATEGY_TABLE_BY_COUNTRY.md) - Current threshold config
- [SYSTEM_WORKFLOW.md](SYSTEM_WORKFLOW.md) - Current system workflow

