# China Market - ATR-based SL Proposal

## üìä ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

**Fixed SL 1.0% ‡∏ó‡∏≥‡πÉ‡∏´‡πâ AvgLoss% ‡∏ñ‡∏π‡∏Å lock ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà ~1.0%**

‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô:
- AvgLoss% ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1.00%, 1.14%, 1.07%, 1.08%
- ‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏ï‡∏≤‡∏° volatility ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏∏‡πâ‡∏ô
- ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ SL ‡∏ó‡∏µ‡πà‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏ß‡πà‡∏≤
- ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÉ‡∏ä‡πâ SL ‡∏ó‡∏µ‡πà‡πÅ‡∏Ñ‡∏ö‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ

---

## üí° ‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ATR-based Stop Loss

### ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:
1. **‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏ï‡∏≤‡∏° Volatility**: ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏°‡∏≤‡∏Å ‚Üí SL ‡∏Å‡∏ß‡πâ‡∏≤‡∏á, ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí SL ‡πÅ‡∏Ñ‡∏ö
2. **AvgLoss% ‡∏à‡∏∞‡πÑ‡∏°‡πà lock**: ‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏° ATR ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏∏‡πâ‡∏ô
3. **Realistic**: ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì SL

### ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:
1. **‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô**: ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ATR
2. **‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£**: AvgLoss% ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô

---

## üéØ ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

### Option 1: ‡πÉ‡∏ä‡πâ ATR-based SL/TP (Dynamic)
```python
RM_USE_ATR = True
RM_ATR_SL = 1.0  # ATR multiplier (‡πÄ‡∏ä‡πà‡∏ô ATR = 2% ‚Üí SL = 2%)
RM_ATR_TP = 4.0  # ATR multiplier (‡πÄ‡∏ä‡πà‡∏ô ATR = 2% ‚Üí TP = 8%)
RM_MAX_HOLD = 3
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚úÖ ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏ï‡∏≤‡∏° volatility
- ‚úÖ AvgLoss% ‡πÑ‡∏°‡πà lock
- ‚úÖ Realistic

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‚ö†Ô∏è ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
- ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤

---

### Option 2: ‡πÉ‡∏ä‡πâ Fixed SL ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏° Volatility (Hybrid)
```python
# ‡πÉ‡∏ä‡πâ effective_std ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
current_vol = effective_std.iloc[i]
if current_vol > 0.02:  # High volatility
    RM_STOP_LOSS = 1.5  # Wider SL
else:  # Low volatility
    RM_STOP_LOSS = 0.8  # Tighter SL
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚úÖ ‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ATR
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (effective_std)

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÄ‡∏ó‡πà‡∏≤ ATR

---

### Option 3: ‡πÉ‡∏ä‡πâ Range-based SL
```python
# ‡πÉ‡∏ä‡πâ high-low range ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
prev_range = (high.iloc[i-1] - low.iloc[i-1]) / close.iloc[i-1]
RM_STOP_LOSS = max(0.8, min(1.5, prev_range * 100))  # 0.8% - 1.5%
```

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‚úÖ ‡∏á‡πà‡∏≤‡∏¢
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á

**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
- ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£

---

## üìã ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

**‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Option 1: ATR-based SL/TP**

**‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:**
1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ATR ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡∏°‡∏µ `calc_atr()` ‡πÅ‡∏•‡∏∞ `simulate_trade_with_rm()`)
2. Taiwan ‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ ATR-based ‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ fixed)
3. ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡πÅ‡∏•‡∏∞ realistic ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î

**‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö:**
- ATR SL: 1.0x, 1.5x, 2.0x
- ATR TP: 4.0x, 6.0x, 8.0x
- Max Hold: 3 days (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°)

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå `test_china_atr_sl.py` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
1. Fixed SL 1.0% (baseline)
2. ATR SL 1.0x (similar to current)
3. ATR SL 1.5x (wider)
4. ATR SL 2.0x (even wider)

‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:
- AvgLoss% (‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô)
- AvgWin%
- RRR
- Count
- Stocks Passing

---

**Date:** 2024-12-XX  
**Status:** Proposal - ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

