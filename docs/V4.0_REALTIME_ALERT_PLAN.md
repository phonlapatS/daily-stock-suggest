
# ğŸš€ V4.0 Implementation Plan: Real-time Alert System
**Codename:** The Watchtower
**Status:** DRAFT (For Mentor Review)
**Target:** Enable real-time notifications for High-Alpha signals.

---

## 1. ğŸ¯ Objective
To transform the system from a "Passive Analysis Tool" (requiring manual execution) into an **"Active Monitoring System"** that notifies the user immediately when high-potential trading opportunities occur.

---

## 2. ğŸ“¡ Core Features (Phase 1: Alerts)

### 2.1 Notification Channels
1.  **LINE Notify:**
    *   **Pros:** Popular in Thailand, Free, Simple HTTP API.
    *   **Cons:** One-way communication (broadcast only).
    *   **Use Case:** Primary channel for urgent Buy/Sell signals.
2.  **Telegram Bot:**
    *   **Pros:** Two-way communication, Rich media (Charts), History retention.
    *   **Cons:** Slightly more complex setup.
    *   **Use Case:** Debug logs, System status, interactive queries (e.g., `/check TPIPP`).

### 2.2 Trigger Logic
The system will run a **Scheduler (Cron/Loop)** to scan assets every **N minutes**:
*   **Gold/Silver:** Every 15 minutes.
*   **Stocks (Thai/US):** Every 1 hour (or End of Day).

**Alert Conditions:**
1.  **New Signal Detection:** Warning when a pattern is found (Prob > Threshold).
2.  **Confirmation:** signal confirmed at bar close.
3.  **Risk Warning:** If an open position hits a Stop Loss zone.

---

## 3. ğŸ—ï¸ System Architecture

### 3.1 New Modules
*   `services/notifier.py`: Handles connection to LINE/Telegram APIs.
*   `services/scheduler.py`: Manages the loop and prevents "Double Alerting" (Spam Protection).
*   `config_v4.py`: Stores API Tokens (Separated from logic).

### 3.2 Workflow
1.  **Scanner:** `intraday_runner.py` scans market data.
2.  **Filter:** Checks if `Prob >= Threshold` (e.g. TPIPP > 0.60%).
3.  **Deduplication:** Checks `last_alert_time` to ensure we don't spam the same signal every minute.
4.  **Dispatcher:** Sends payload to `notifier.py`.
5.  **User Receives:** "ğŸš€ **BUY SIGNAL** | TPIPP | Prob: 65% | Price: 3.40"

---

## 4. ğŸ“Š Dashboard Concept (Phase 2: Visuals)
*(Optional: For discussion with Mentor)*

A simple **Web Dashboard (Streamlit/Flask)** to visualize:
1.  **Live Equity Curve:** Real-time update of the portfolio graph.
2.  **Active Signals:** List of currently active signals (Table 1/2).
3.  **System Health:** Heartbeat status (Is the scanner running?).

---

## 5. ğŸ› ï¸ Technical Requirements

### Libraries
*   `requests` (Standard)
*   `python-telegram-bot` (Optional for advanced features)
*   `schedule` or `APScheduler` (For precise timing)

### Configuration Needed
*   **LINE Token:** Generated from [notify-bot.line.me](https://notify-bot.line.me/)
*   **Telegram Bot Token:** From @BotFather

---

## 6. ğŸ“… Implementation Roadmap (Draft)

| Step | Task | Complexity | Estimated Time |
|---|---|---|---|
| 1 | Create `notifier.py` wrapper for LINE API | ğŸŸ¢ Low | 1-2 Hours |
| 2 | Integrate Alert Logic into `intraday_runner.py` | ğŸŸ¡ Medium | 3-4 Hours |
| 3 | Implement "Spam Protection" (Dedup Logic) | ğŸŸ¡ Medium | 2 Hours |
| 4 | Test with Mock Signals (Simulation) | ğŸŸ¢ Low | 1 Hour |
| 5 | Deploy on Cloud/Server (VPS) | ğŸ”´ High | 1 Day |

---

## ğŸ“ Questions for Mentor
1.  **Platform Preference:** Should we prioritize LINE (Simple) or Telegram (Rich Features)?
2.  **Server Requirement:** Does the team have a VPS/Cloud server to run this 24/7?
3.  **Scope:** Should we include the Web Dashboard in V4.0 or wait for V5.0?
