# ğŸ“Š V3.4 Development Roadmap
## "The Adaptive Engine"

---

## ğŸ¯ Project Overview

**Project Name:** Fractal N+1 Prediction System  
**Current Version:** V3.4 - The Adaptive Engine  
**Branch:** `version-3.4`  
**Last Updated:** 2026-02-05

---

## ğŸ“ˆ Version History

| Version | Codename | Release Date | Key Features |
|---------|----------|--------------|--------------|
| V1.0 | Foundation | 2025-12 | Basic Pattern Matching |
| V2.0 | Enhanced | 2026-01 | Multi-timeframe Support |
| V3.0 | Statistical | 2026-01 | Statistical Filtering |
| V3.1 | Strict | 2026-01 | Streak Logic + Thresholds |
| V3.2 | Scored | 2026-01 | Confidence & Risk Scoring |
| V3.3 | Metrics | 2026-02 | Performance Logging + 4-Table Report |
| **V3.4** | **Adaptive** | **2026-02** | **Dynamic Pattern + Cache System** |

---

## ğŸ”§ V3.3 â†’ V3.4 Change Log

### ğŸ“… Day 1: V3.3 Completion (2026-02-04)

#### 4-Table Report System
| Change | File | Description |
|--------|------|-------------|
| Table 1: Thai Strict | `scripts/calculate_metrics.py` | Prob > 60%, RR > 2.0 |
| Table 2: Thai Balanced | `scripts/calculate_metrics.py` | Prob > 60%, 1.5 < RR â‰¤ 2.0 |
| Table 3: International Observation | `scripts/calculate_metrics.py` | Prob > 55%, RR > 1.1 |
| Table 4: International Sensitivity | `scripts/calculate_metrics.py` | Prob > 50%, 0.5 < RR â‰¤ 1.1 |

#### Report Enhancements
| Change | File | Description |
|--------|------|-------------|
| Symbol Mapping | `scripts/calculate_metrics.py` | 9988 â†’ ALIBABA, 600519 â†’ MOUTAI |
| Country Codes | `scripts/calculate_metrics.py` | TH, US, CN, HK, TW |
| Min Signal â‰¥ 30 | `scripts/calculate_metrics.py` | Filter low-count patterns |
| Integer Formatting | `scripts/calculate_metrics.py` | Signals column as int |

---

### ğŸ“… Day 2: V3.4 Development (2026-02-04 ~ 2026-02-05)

#### Phase 4.1: Dynamic Pattern Detection
| Change | File | Description |
|--------|------|-------------|
| Pattern Length 3-8 Days | `processor.py` | Scan multiple pattern lengths |
| Best Pattern Selection | `processor.py` | Choose longest effective pattern |
| Backtest Sync | `scripts/backtest.py` | Same logic in backtesting |
| IndentationError Fix | `processor.py` | Lines 237-305 |

#### Phase 4.2: Adaptive Data Splitting
| Change | File | Description |
|--------|------|-------------|
| Established (>1000 bars) | `scripts/backtest.py` | Fixed 250-bar test window |
| Growing (220-1000 bars) | `scripts/backtest.py` | 80/20 Train/Test split |
| Emerging (<220 bars) | `scripts/backtest.py` | Graceful handling |
| Min Data 1000 â†’ 250 | `scripts/backtest.py` | Support newer stocks |

#### Phase 4.3: Intraday Scanner
| Change | File | Description |
|--------|------|-------------|
| Intraday Runner | `scripts/intraday_runner.py` | **NEW** Gold/Silver 15m/30m |
| 24h Monitoring Loop | `scripts/intraday_runner.py` | Continuous scanning |
| Alert on High Prob >60% | `scripts/intraday_runner.py` | Notification system |

#### Phase 5: OHLC Cache System
| Change | File | Description |
|--------|------|-------------|
| Cache Module | `core/data_cache.py` | **NEW** Local OHLC storage |
| `has_cache()` | `core/data_cache.py` | Check cache existence |
| `load_cache()` | `core/data_cache.py` | Load from CSV |
| `save_cache()` | `core/data_cache.py` | Save to CSV |
| `update_cache()` | `core/data_cache.py` | Merge old + new data |
| `get_data_with_cache()` | `core/data_cache.py` | Smart fetch (Delta 50 bars) |
| `is_cache_stale()` | `core/data_cache.py` | Check if >12 hours old |
| Cache Integration | `main.py` | Use cache in fetch_and_analyze |
| Rate Limiting | `main.py` | 1s delay + Exponential Backoff |
| TradingView Login | `main.py` | Account authentication |

#### Phase 6: Project Cleanup
| Change | File | Description |
|--------|------|-------------|
| Deleted debug_counts.py | Root | Unused debug script |
| Deleted verify_consistency.py | Root | Unused debug script |
| Deleted view_streak.py | Root | Old view script |
| Deleted view_stats.py | Root | Old view script |
| Deleted view_report.py | Root | Replaced by v2 |
| Deleted batch_processor.py | Root | Unused processor |
| Deleted debug_*.py | scripts/ | Debug scripts (3 files) |

---

## ğŸ—ï¸ System Architecture V3.4

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    V3.4: THE ADAPTIVE ENGINE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  TradingView â”‚â”€â”€â”€â–¶â”‚ Data Cache  â”‚â”€â”€â”€â–¶â”‚  Processor  â”‚          â”‚
â”‚  â”‚     API      â”‚    â”‚  (NEW V3.4) â”‚    â”‚             â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                      â”‚                 â”‚
â”‚         â”‚ First Run: 5000 bars                â”‚                 â”‚
â”‚         â”‚ Next Runs: 50 bars (Delta)          â”‚                 â”‚
â”‚         â”‚                                      â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   Rate      â”‚                      â”‚  Dynamic    â”‚           â”‚
â”‚  â”‚  Limiter    â”‚                      â”‚  Pattern    â”‚           â”‚
â”‚  â”‚  (1s delay) â”‚                      â”‚  (3-8 days) â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                              â”‚                   â”‚
â”‚                                              â–¼                   â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                       â”‚  Scoring    â”‚           â”‚
â”‚                                       â”‚ Confidence  â”‚           â”‚
â”‚                                       â”‚   + Risk    â”‚           â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                              â”‚                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â–¼                                            â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Daily     â”‚                           â”‚  Intraday   â”‚      â”‚
â”‚  â”‚  Scanner    â”‚                           â”‚  Scanner    â”‚      â”‚
â”‚  â”‚  (Stocks)   â”‚                           â”‚(Gold/Silver)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                                         â”‚             â”‚
â”‚         â–¼                                         â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Pattern    â”‚                           â”‚  15m / 30m  â”‚      â”‚
â”‚  â”‚   Stats     â”‚                           â”‚  Timeframe  â”‚      â”‚
â”‚  â”‚ (Incremental)â”‚                          â”‚             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              4-TABLE REPORT SYSTEM                   â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ Thai Strict â”‚Thai Balancedâ”‚ Intl Obs    â”‚Intl Sens  â”‚        â”‚
â”‚  â”‚ P>60 RR>2.0 â”‚P>60 RR>1.5  â”‚ P>55 RR>1.1 â”‚P>50 RR>0.5â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Active Files (V3.4)

### Root Level
| File | Purpose | Status |
|------|---------|--------|
| `main.py` | Main runner with cache integration | âœ… Updated |
| `processor.py` | Pattern analysis (Dynamic 3-8 days) | âœ… Updated |
| `config.py` | Configuration & asset groups | âœ… Active |
| `requirements.txt` | Dependencies | âœ… Active |
| `README.md` | Project overview | âœ… Active |

### Core Module
| File | Purpose | Status |
|------|---------|--------|
| `core/data_cache.py` | OHLC cache manager | ğŸ†• NEW |
| `core/pattern_stats.py` | Incremental stats | âœ… Active |
| `core/performance.py` | Forecast logging | âœ… Active |
| `core/scoring.py` | Confidence & risk | âœ… Active |
| `core/data_fetcher.py` | Data utilities | âœ… Active |
| `core/predictor.py` | Prediction logic | âœ… Active |

### Scripts
| File | Purpose | Status |
|------|---------|--------|
| `scripts/backtest.py` | Backtesting engine | âœ… Updated |
| `scripts/calculate_metrics.py` | 4-Table report | âœ… Updated |
| `scripts/intraday_runner.py` | Gold/Silver monitor | ğŸ†• NEW |
| `scripts/fact_check.py` | Fact check export | âœ… Active |
| `scripts/health_check.py` | System health | âœ… Active |
| `scripts/master_scanner.py` | Master scanner | âœ… Active |
| `scripts/stateless_scanner.py` | Correlation scanner | âœ… Active |
| `scripts/view_accuracy.py` | Accuracy viewer | âœ… Active |
| `scripts/filter_signals.py` | Signal filtering | âœ… Active |
| `scripts/check_gold_silver.py` | Metals check | âœ… Active |

---

## ğŸ“‹ Pending Tasks (Next Session)

| # | Task | Priority | Description |
|---|------|----------|-------------|
| 1 | Test Cache System | ğŸ”´ HIGH | Run main.py after rate limit reset |
| 2 | Test Intraday Runner | ğŸŸ  MED | Gold/Silver 15m/30m real-time |
| 3 | Compare Run Time | ğŸŸ  MED | Before/After cache benchmark |
| 4 | Delete Remaining Files | ğŸŸ¢ LOW | scripts/test_*.py, scanner*.py |
| 5 | Trend Following Research | ğŸ”µ FUTURE | US Market strategy |

---

## ğŸ“ Key Learnings

1. **Rate Limiting is Critical:** TradingView blocks IPs with too many requests
2. **Cache First:** Always cache raw data to avoid redundant API calls
3. **Dynamic Patterns:** Longer patterns (6-8 days) often have higher accuracy
4. **Adaptive Splitting:** Different data strategies for different stock maturities

---

## ğŸ“ Contact

- **GitHub:** [phonlapatS/daily-stock-suggest](https://github.com/phonlapatS/daily-stock-suggest)
- **Branch:** version-3.4
