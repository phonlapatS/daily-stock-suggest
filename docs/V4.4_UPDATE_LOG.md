# Prediction System V4.4 Update Log (2026-02-22)

## üéØ "The Consensus Engine" - Aggregate Voting & Dynamic Streak

Version 4.4 represents a fundamental shift in how the system interprets price action and historical statistics. We moved from a "Best Fit" selection model to a "Consensus-based Aggregate Voting" model.

---

## üõ†Ô∏è Key Technical Changes

### 1. Dynamic Streak Extraction (until-neutral)
- **Previous:** Fixed lookback (3-8 days) scan for best match.
- **Current:** System now starts from today and walks backward, counting every consecutive significant move (+) or (-). The extraction **stops immediately** on the first "Neutral" day.
- **Benefit:** Captures the full momentum of a move without arbitrary day cutoffs.

### 2. Aggregate Voting (Consensus Module)
- **Previous:** Select one "Best Fit" pattern based on length and probability.
- **Current:** The active pattern is broken down into all possible suffixes (e.g., `++-` becomes `++-`, `+-`, and `-`).
- **Logic:** Each suffix is treated as a "voter":
  - Each voter identify their local winner (Winner-Takes-All).
  - Only the winner's count is added to the consensus jar.
  - Final prediction is the majority winner of the consolidated weight.

### 3. Statistical Gatekeeper (Min 30 Requirement)
- **Requirement:** Each suffix voter MUST have at least **30 historical occurrences** to participate.
- **Reasoning:** Enforces the Central Limit Theorem at the consensus level. Prevents low-sample "lucky" patterns from diluting the vote.

### 4. Simplified Terminal Reporting
- Output is streamlined for high-speed decision making.
- Display: `Symbol | Forecast | Prob%`
- Detailed voting breakdowns (e.g., `++-:40/20(P); +-:35/15(P)`) are preserved in the `performance_log.csv` for audit.

---

## üìà Impact on Performance

| Metric | v4.1 (Prev) | v4.4 (Current) | Difference |
|--------|-------------|----------------|------------|
| Stability | Medium | **High** | Reduced impact of outliers |
| Logic | Heuristic | **Mathematical** | Consensus-based |
| Noise | Higher | **Filtered** | 30-sample gatekeeper |

---

## üìÅ Updated Files
- `core/engines/base_engine.py`: Refactored for streak extraction and voting.
- `core/engines/reversion_engine.py`: Updated for consensus Jar.
- `core/engines/trend_engine.py`: Updated for consensus Jar.
- `main.py`: Simplified reporting table.
- `processor.py`: Router updated for voting results.

---

## üöÄ How to Run
```bash
python main.py
```
Check `data/performance_log.csv` for the granular suffix-by-suffix breakdown.

---
*Last Edited: 2026-02-22*
