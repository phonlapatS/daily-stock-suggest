# System V4.3: Intraday Body Logic — Walkthrough

## Major Logic Shift

The system has transitioned from **Inter-day Returns** (Close-to-Close) to **Intraday Body Logic** (Open-to-Close). This shift aligns the pattern detection and performance logging with visual candlestick analysis (Candle Color).

### Changes Made

| Component | Logic Update | Formula |
|-----------|--------------|---------|
| **Core Engines** | Pattern detection characters (+/-) are now based on daily body strength. | `(Close - Open) / Open` |
| **Stats Engine** | Historical scanning and N+1 prediction profit are calculated using intraday moves. | `(NextClose - NextOpen) / NextOpen` |
| **Processor** | Daily log entries (`change_pct`) now record the intraday body percentage. | `(Close - Open) / Open * 100` |
| **Performance** | Performance calculation script (`calculate_performance.py`) uses intraday yields for P/L reporting. | `Gross P/L based on Intraday %` |

### Files Modified

- [reversion_engine.py](file:///e:/PredictPlus1/core/engines/reversion_engine.py): Integrated custom intraday stats scan.
- [trend_engine.py](file:///e:/PredictPlus1/core/engines/trend_engine.py): Overrode `get_pattern_stats` for regime-aware intraday logic.
- [processor.py](file:///e:/PredictPlus1/processor.py): Updated `change_pct` logging.
- [generate_master_stats.py](file:///e:/PredictPlus1/scripts/generate_master_stats.py): Added `Next_Up`/`Next_Down` stats based on intraday exceedance.
- [calculate_performance.py](file:///e:/PredictPlus1/scripts/calculate_performance.py): Removed PF Ratio and Net P/L as requested.

## Verification

### Master Stats Alignment
- [Master_Pattern_Stats_NewLogic.csv](file:///e:/PredictPlus1/data/Master_Pattern_Stats_NewLogic.csv) now correctly counts `Next_Up`, `Next_Down`, and `Next_Neutral` based on threshold exceedance within the day.

### GitHub Migration
- All code, scripts, documentation, and data files (~18.6 MB) successfully pushed to branch `version-4.3`.
- Ready for deployment on Mac.

✅ `python main.py` — PASS
✅ `python scripts/calculate_performance.py` — PASS (Clean Report)
