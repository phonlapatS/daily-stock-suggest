# üìñ PredictPlus1 ‚Äî System Manual
**‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏∏‡πâ‡∏ô N+1 Day (Fractal Pattern Detection)**  
**Version:** V7.1 ‚Äî Pattern Logic Refactor (Streak-Based Scanning)  
**Last Updated:** 2026-02-19

---

## üìë ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
2. [‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô](#2-‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)
3. [‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç](#3-‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
4. [‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°](#4-‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å)
5. [‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î](#5-‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)
6. [‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ](#6-‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ)
7. [Engine Logic ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢](#7-engine-logic)
8. [Core Logic ‚Äî Pattern Counting (V7.1)](#8-core-logic)
9. [‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô](#9-‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô)
10. [Troubleshooting](#10-troubleshooting)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

PredictPlus1 ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏∏‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **Fractal Pattern Detection** ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡πà‡∏≤ ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î Pattern ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 3 ‡∏ß‡∏±‡∏ô `+++`) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡πà‡∏≤ Pattern ‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (N+1)

### Flow ‡∏´‡∏•‡∏±‡∏Å:
```
‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (TvDatafeed)
    ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Dynamic Threshold (MAX(20d SD, 252d SD, Floor))
    ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤ Active Pattern (Dynamic Lookback)
    ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Best Fit Pattern ‡∏à‡∏≤‡∏Å Master Stats
    ‚Üí ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (UP/DOWN)
    ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
```

### ‡∏ï‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö (6 ‡∏ï‡∏•‡∏≤‡∏î):
| ‡∏ï‡∏•‡∏≤‡∏î | Engine | Direction Logic | Floor |
|-------|--------|----------------|-------|
| üáπüá≠ Thai (SET) | Thai Logic Threshold | **Mean Reversion** | 1.0% |
| üá∫üá∏ US (NASDAQ) | US Logic Threshold | **Trend Following** | 0.6% |
| üá®üá≥üá≠üá∞ China/HK (HKEX) | China Logic Threshold | **Mean Reversion** | 0.8% |
| üáπüáº Taiwan (TWSE) | Taiwan Logic Threshold | **Trend Following** | 0.9% |
| ü•á Gold (30m/15m) | Reversion Engine | Mean Reversion | 0.3% |
| ü•à Silver (30m/15m) | Reversion Engine | Mean Reversion | 0.3% |

---

## 2. ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô

### Python & Dependencies
```bash
python >= 3.10
pip install tvdatafeed pandas numpy python-dotenv requests
```

### Environment Variables (`.env`)
```ini
TV_USERNAME=your_tradingview_username
TV_PASSWORD=your_tradingview_password
TV_SESSIONID=your_session_id          # optional
```

---

## 3. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

```
PredictPlus1/
‚îú‚îÄ‚îÄ main.py                          # üîÆ ‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å: ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ + ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
‚îú‚îÄ‚îÄ config.py                        # ‚öôÔ∏è  ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å asset group + engine + threshold
‚îú‚îÄ‚îÄ processor.py                     # üß© Router: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å engine ‡∏ï‡∏≤‡∏° config
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ engines/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_engine.py           # üèóÔ∏è  Base class + calculate_dynamic_threshold()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ thai_logic_threshold_only.py    # üáπüá≠ Thai engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ us_logic_threshold_only.py      # üá∫üá∏ US engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ china_logic_threshold_only.py   # üá®üá≥ China engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hongkong_logic_threshold_only.py # üá≠üá∞ HK engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ taiwan_logic_threshold_only.py  # üáπüáº Taiwan engine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reversion_engine.py      # Mean Reversion (Gold/Silver)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trend_engine.py          # Trend Following (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ performance.py               # üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + verify forecasts
‚îÇ   ‚îú‚îÄ‚îÄ pattern_stats.py             # üìà ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Master Stats
‚îÇ   ‚îî‚îÄ‚îÄ data_cache.py               # üíæ Smart caching ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ generate_master_stats.py     # üîß ‡∏™‡∏£‡πâ‡∏≤‡∏á Master Pattern Stats
‚îÇ   ‚îú‚îÄ‚îÄ backfill_forward_testing.py  # üîÑ Backfill forward testing ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
‚îÇ   ‚îú‚îÄ‚îÄ check_forward_testing.py     # ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (pending/verified)
‚îÇ   ‚îú‚îÄ‚îÄ forward_testing_report.py    # üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô forward testing ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
‚îÇ   ‚îú‚îÄ‚îÄ calculate_performance.py     # üìà ‡∏™‡∏£‡∏∏‡∏õ performance (trade history)
‚îÇ   ‚îî‚îÄ‚îÄ daily_forecast_dashboard.py  # üì∫ Dashboard executive summary
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ Master_Pattern_Stats_NewLogic.csv   # üìä Pattern database (count only)
‚îÇ   ‚îú‚îÄ‚îÄ forecast_tomorrow.csv               # üîÆ Predictions ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
‚îÇ   ‚îú‚îÄ‚îÄ daily_forecast_summary_*.csv        # üìã Summary ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
‚îÇ   ‚îî‚îÄ‚îÄ cache/                              # üíæ Cached price data
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ performance_log.csv                 # üìã Forward testing log (main file)
‚îÇ   ‚îú‚îÄ‚îÄ trade_history_*.csv                 # üìà Trade history per market
‚îÇ   ‚îî‚îÄ‚îÄ performance_log_backup_*.csv        # üíø Backups
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ SYSTEM_MANUAL.md                    # üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ
    ‚îî‚îÄ‚îÄ ENGINE_MIGRATION_V7.md              # üìã Change log
```

---

## 4. ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å

### Quick Reference (‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

```bash
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üîÆ ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ N+1 (‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô)
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
python main.py

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üìä ‡∏î‡∏π‡∏ú‡∏• Forward Testing & Performance
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
python scripts/check_forward_testing.py          # ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô
python scripts/check_forward_testing.py --verify  # ‡∏ï‡∏£‡∏ß‡∏à + verify pending
python scripts/forward_testing_report.py          # ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
python scripts/forward_testing_report.py --verify  # ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô + verify ‡∏Å‡πà‡∏≠‡∏ô
python scripts/calculate_performance.py           # ‡∏™‡∏£‡∏∏‡∏õ Win Rate
python scripts/daily_forecast_dashboard.py        # Dashboard executive

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üîß ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Maintenance (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô)
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
python scripts/generate_master_stats.py           # ‡∏™‡∏£‡πâ‡∏≤‡∏á Master Stats ‡πÉ‡∏´‡∏°‡πà
python scripts/backfill_forward_testing.py        # Backfill ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
```

---

## 5. ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### 5.1 üîÆ `python main.py` ‚Äî ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ N+1 + ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏ó‡∏≥‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥:**
1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏à‡∏≤‡∏Å TradingView (‡πÉ‡∏ä‡πâ cache ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Dynamic Threshold ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å stock
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤ Active Pattern ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
4. ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á N+1 day (UP/DOWN)
5. **‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô:** verify forecasts ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà PENDING ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
6. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å forecasts ‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á `logs/performance_log.csv`
7. ‡∏™‡∏£‡πâ‡∏≤‡∏á `data/forecast_tomorrow.csv` (overwrite ‡∏ó‡∏∏‡∏Å‡∏£‡∏±‡∏ô)
8. ‡∏™‡∏£‡πâ‡∏≤‡∏á `data/daily_forecast_summary_YYYY-MM-DD.csv`

**Output ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å update:**
| ‡πÑ‡∏ü‡∏•‡πå | ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á |
|------|----------------|
| `logs/performance_log.csv` | Append forecasts ‡πÉ‡∏´‡∏°‡πà + verify ‡πÄ‡∏Å‡πà‡∏≤ |
| `data/forecast_tomorrow.csv` | **Overwrite** ‡∏ó‡∏∏‡∏Å‡∏£‡∏±‡∏ô |
| `data/daily_forecast_summary_*.csv` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ |

**‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:** ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô (‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏¥‡∏î)

```bash
python main.py
```

---

### 5.2 ‚úÖ `python scripts/check_forward_testing.py` ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏î‡∏π forecasts ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‚Äî ‡∏ó‡∏±‡πâ‡∏á PENDING ‡πÅ‡∏•‡∏∞ Verified

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:**
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô forecasts ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô log
- **PENDING:** forecasts ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ verify (‡πÅ‡∏¢‡∏Å Ready vs Waiting)
- **Verified:** ‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß (‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î)
- ‡∏™‡∏£‡∏∏‡∏õ accuracy ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° symbol ‡πÅ‡∏•‡∏∞ pattern

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô:** `logs/performance_log.csv`

**Options:**
```bash
# ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
python scripts/check_forward_testing.py

# Verify pending forecasts ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å TV)
python scripts/check_forward_testing.py --verify

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (default: 30 ‡∏ß‡∏±‡∏ô)
python scripts/check_forward_testing.py --days 60

# ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å verified (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà 10 ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
python scripts/check_forward_testing.py --all
```

---

### 5.3 üìä `python scripts/forward_testing_report.py` ‚Äî ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Forward Testing ‡πÅ‡∏ö‡∏ö Human-friendly

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:**
- Summary: Total / Verified / Pending / Accuracy
- **By Exchange:** accuracy ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î
- **By Forecast Direction:** accuracy ‡πÅ‡∏¢‡∏Å UP/DOWN
- **Top 10 Move%:** ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô/‡∏•‡∏á‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô:** `logs/performance_log.csv`

**Options:**
```bash
# ‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥
python scripts/forward_testing_report.py

# Verify pending ‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
python scripts/forward_testing_report.py --verify

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤
python scripts/forward_testing_report.py --days 60

# Export ‡πÄ‡∏õ‡πá‡∏ô CSV
python scripts/forward_testing_report.py --export data/forward_report.csv

# ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å option
python scripts/forward_testing_report.py --verify --days 60 --export data/report.csv
```

---

### 5.4 üìà `python scripts/calculate_performance.py` ‚Äî ‡∏™‡∏£‡∏∏‡∏õ Performance

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Win Rate, Profit Factor ‡∏à‡∏≤‡∏Å trade history

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:**
- **Level A ‚Äî Market Summary:** Profit/Loss, Avg, Win Rate
- **Level B ‚Äî Per-Stock Precision:** W/L, Win Rate, RRR per stock

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô:** `data/logs/*/` (trade history CSVs per market)  
**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô (fallback):** `logs/trade_history_*.csv`

```bash
python scripts/calculate_performance.py
```

**Output ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:**
- `data/stock_stats_*.csv` ‚Äî Stats per stock per market
- `data/performance_summary_*.csv` ‚Äî Summary per market

---

### 5.5 üì∫ `python scripts/daily_forecast_dashboard.py` ‚Äî Dashboard

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** Executive Dashboard ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:**
- Tomorrow's Forecasts: ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô/‡∏•‡∏á
- Accuracy Report: Win Rate ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° symbol
- Summary: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô signals, avg probability

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô:** `logs/performance_log.csv`

```bash
python scripts/daily_forecast_dashboard.py
```

---

### 5.6 üîß `python scripts/generate_master_stats.py` ‚Äî ‡∏™‡∏£‡πâ‡∏≤‡∏á Master Stats

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** Scan ‡∏ó‡∏∏‡∏Å stock 5000 bars ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á pattern database ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥:**
1. ‡∏î‡∏∂‡∏á 5000 bars ‡∏ï‡πà‡∏≠ stock ‡∏à‡∏≤‡∏Å TradingView
2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Dynamic Threshold
3. Enumerate ‡∏ó‡∏∏‡∏Å pattern (1-7 chars) ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á
4. ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Count)
5. Track Max Streak (Positive/Negative)

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:** `data/Master_Pattern_Stats_NewLogic.csv`

**Columns:** `Symbol, Market, Threshold, Max_Streak_Pos, Max_Streak_Neg, Pattern, Pattern_Name, Category, Length, Count, Bars`

> ‚ö†Ô∏è **‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô** (~20-30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 242 stocks)  
> ‚ö†Ô∏è **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô** ‚Äî ‡∏£‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô engine logic ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï stats

```bash
python scripts/generate_master_stats.py
```

---

### 5.7 üîÑ `python scripts/backfill_forward_testing.py` ‚Äî Backfill ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏à‡∏≥‡∏•‡∏≠‡∏á forward testing ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥:**
1. ‡πÇ‡∏´‡∏•‡∏î `Master_Pattern_Stats_NewLogic.csv` ‡πÄ‡∏õ‡πá‡∏ô pattern lookup
2. ‡∏î‡∏∂‡∏á ~500 bars ‡∏ï‡πà‡∏≠ stock (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö threshold)
3. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ trading day:
   - Dynamic Lookback ‚Üí Active Pattern
   - Best Fit Selection ‡∏à‡∏≤‡∏Å Master Stats
   - Verify actual N+1 result
4. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏á `logs/performance_log.csv`

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:** `logs/performance_log.csv`

**Anti-Overlapping:** 1 result ‡∏ï‡πà‡∏≠ stock ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (count ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)

```bash
# Backfill ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà Feb 12 ‚Üí yesterday
python scripts/backfill_forward_testing.py --start-date 2026-02-12

# ‡∏£‡∏∞‡∏ö‡∏∏ end date
python scripts/backfill_forward_testing.py --start-date 2026-02-12 --end-date 2026-02-18
```

---

## 6. ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ

### 6.1 Input Files (‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô)

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|------|---------|---------|
| `data/Master_Pattern_Stats_NewLogic.csv` | backfill, engines | Pattern database (count only) |
| `data/cache/*.csv` | main.py, scripts | Cached price data |
| `.env` | main.py, scripts | TradingView credentials |

### 6.2 Output Files (‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô)

| ‡πÑ‡∏ü‡∏•‡πå | ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢ | Mode | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|------|---------|------|---------|
| `logs/performance_log.csv` | main.py, backfill | Append | **Forward testing log ‡∏´‡∏•‡∏±‡∏Å** |
| `data/forecast_tomorrow.csv` | main.py | Overwrite | Predictions ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î |
| `data/daily_forecast_summary_*.csv` | main.py | Create | Summary ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô |
| `data/Master_Pattern_Stats_NewLogic.csv` | generate_master_stats | Overwrite | Pattern database |

### 6.3 ‡πÉ‡∏Ñ‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£ (Dependency Map)

```
logs/performance_log.csv ‚Üê ‡πÑ‡∏ü‡∏•‡πå‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Forward Testing
    ‚îú‚îÄ‚îÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: check_forward_testing.py
    ‚îú‚îÄ‚îÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: forward_testing_report.py
    ‚îú‚îÄ‚îÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: daily_forecast_dashboard.py
    ‚îú‚îÄ‚îÄ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢: main.py (append + verify)
    ‚îî‚îÄ‚îÄ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢: backfill_forward_testing.py (append)

data/Master_Pattern_Stats_NewLogic.csv ‚Üê Pattern Database
    ‚îú‚îÄ‚îÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: backfill_forward_testing.py
    ‚îî‚îÄ‚îÄ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢: generate_master_stats.py

logs/trade_history_*.csv ‚Üê Trade History (legacy)
    ‚îú‚îÄ‚îÄ ‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: calculate_performance.py
    ‚îî‚îÄ‚îÄ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢: main.py (via performance module)
```

---

## 7. Engine Logic

### 7.1 Dynamic Threshold
```python
threshold = MAX(
    pct_change.rolling(20).std(),    # Short-term: 20-day SD
    pct_change.rolling(252).std(),   # Long-term: 252-day SD (‚âà1 year)
    market_floor                      # Absolute minimum (e.g. 0.01 for Thai)
)
```

### 7.2 Signal Generation
```
‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ return > +threshold  ‚Üí  signal = '+'
‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ return < -threshold  ‚Üí  signal = '-'
‡∏≠‡∏∑‡πà‡∏ô‡πÜ (|return| ‚â§ threshold) ‚Üí  signal = '.' (neutral, ‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö)
```

### 7.3 Active Pattern (Dynamic Lookback)
- Scan ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- ‡∏™‡∏£‡πâ‡∏≤‡∏á pattern ‡∏à‡∏≤‡∏Å signals ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà neutral ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô
- ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠ neutral day
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 7 characters
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: `++-` = ‡∏Ç‡∏∂‡πâ‡∏ô 2 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏á 1 ‡∏ß‡∏±‡∏ô

### 7.4 Direction Logic

| Logic | Pattern ‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢ `+` | Pattern ‡∏à‡∏ö‡∏î‡πâ‡∏ß‡∏¢ `-` |
|-------|-------------------|-------------------|
| **Mean Reversion** (TH, CN, HK, Gold, Silver) | ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ **DOWN** ‚Üì | ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ **UP** ‚Üë |
| **Trend Following** (US, TW) | ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ **UP** ‚Üë | ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ **DOWN** ‚Üì |

### 7.5 Rule 4: NEUTRAL = LOSS
- ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô N+1 ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô threshold ‚Üí ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ **NEUTRAL**
- NEUTRAL ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô **LOSS** (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å ‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î ‚Üí ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏¥‡∏î)

---

## 8. Core Logic ‚Äî Pattern Counting (V7.1)

### 8.1 Core Logic 1: Pattern String Accumulation

**‡∏Å‡∏é:** Mixed signs (`+/-`) **‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï**‡πÉ‡∏ô streak ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Äî ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠ **Neutral day** (`|return| < threshold`)

```
raw returns:  +2.1%  -1.5%  +0.3%  -2.0%  +1.8%
threshold:    ¬±1.0%  ¬±1.0%  ¬±1.0%  ¬±1.0%  ¬±1.0%
signals:       +      -      .      -      +
                            ‚Üë neutral = BREAK

streak 1: "+-"   (‡∏ß‡∏±‡∏ô 1-2)
streak 2: "-+"   (‡∏ß‡∏±‡∏ô 4-5)
```

> ‚ö†Ô∏è **‡∏Å‡πà‡∏≠‡∏ô V7.1:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏° neutral day ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πà‡∏≠ pattern ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô `+-.+` ‚Üí `"+-+"` (**‡∏ú‡∏¥‡∏î!**)  
> ‚úÖ **V7.1:** neutral day ‡∏ï‡∏±‡∏î streak ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Üí `"+-"` + `"-+"` (**‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á**)

### 8.2 Mode A: Historical Stats (Overlapping Sliding Window)

**‡πÉ‡∏ä‡πâ‡πÉ‡∏ô:** `get_pattern_stats()`, `generate_master_stats.py`  
**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏±‡∏ö:** Streak-based scanning

```
1. Build signal series ‡∏ó‡∏±‡πâ‡∏á 5000 bars:  [+, -, ., +, +, -, ., ...]
2. ‡∏´‡∏≤ streaks (‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ '.'):       [+, -]   [+, +, -]   ...
3. Enumerate sub-patterns ‡πÅ‡∏ï‡πà‡∏•‡∏∞ streak:
   streak "++-" ‚Üí sub-patterns: "+", "+", "-", "++", "+-", "++-"
4. ‡∏ñ‡πâ‡∏≤ sub-pattern ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö target ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å N+1 future return
```

**‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á‡πÉ‡∏ä‡πâ overlapping?**  
‡πÄ‡∏û‡∏£‡∏≤‡∏∞ streak `"++-"` ‡∏°‡∏µ `"+"` 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô ‚Üí ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô occurrence ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô = N+1 return ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô)

### 8.3 Mode B: Forward Testing (Non-Overlapping Events)

**‡πÉ‡∏ä‡πâ‡πÉ‡∏ô:** `main.py` (predict), `backfill_forward_testing.py`  
**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏±‡∏ö:** 1 prediction ‡∏ï‡πà‡∏≠ stock ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (Anti-Overlapping)

```
‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ STOCK_A ‡∏°‡∏µ pattern "++-":
  - ‡∏•‡∏≠‡∏á "++-" ‚Üí count=45, prob=63%  ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô (count ‚â• 30)
  - ‡∏•‡∏≠‡∏á "+-"  ‚Üí count=120, prob=58% ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô
  - ‡∏•‡∏≠‡∏á "-"   ‚Üí count=300, prob=55% ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô
  ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "++-" (prob ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 63%) ‚Üí ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
```

### 8.4 ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Logic ‡πÉ‡∏´‡∏°‡πà (V7.1)

| ‡πÑ‡∏ü‡∏•‡πå | ‡πÉ‡∏ä‡πâ Logic | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|------|----------|----------|
| `base_engine.py` | Mode A (streak-based) | `extract_pattern()`, `get_pattern_stats()`, `select_best_fit()` |
| `trend_engine.py` | Mode A + Regime Filter | Override `get_pattern_stats()` ‡∏û‡∏£‡πâ‡∏≠‡∏° BULL/BEAR filter |
| `pattern_matcher_basic.py` | Mode A (streak-based) | `extract_pattern()`, `find_pattern_matches()`, `get_best_pattern()` |
| `backtest_with_trailing_stop.py` | Mode A (streak-based) | Pattern stats building + sub-pattern matching |
| *5 engines + reversion_engine* | Inherit ‡∏à‡∏≤‡∏Å base | **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ** ‚Äî ‡πÑ‡∏î‡πâ fix ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô inheritance |

---

## 9. ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô

### üåÖ Daily Routine (Run Order ‚Äî **‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô**)

| ‡∏•‡∏≥‡∏î‡∏±‡∏ö | ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡πÄ‡∏ß‡∏•‡∏≤ |
|:-----:|--------|---------|------|
| **1** | `python main.py` | ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ N+1 + ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log | ~5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| **2** | `python scripts/check_forward_testing.py` | ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ pending/verified/accuracy | ~1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| **3** | `python scripts/forward_testing_report.py` | ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Forward Testing ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î | ~1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| **4** | `python scripts/calculate_performance.py` | ‡∏™‡∏£‡∏∏‡∏õ Performance (Win Rate, RRR) | ~1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| **5** | `python scripts/daily_forecast_dashboard.py` | Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° | ~1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

```bash
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üåÖ DAILY ROUTINE ‚Äî ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏¥‡∏î (‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö)
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# STEP 1: ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ + ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (CORE ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠)
python main.py
#   ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏∏‡πâ‡∏ô ‚Üí ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ N+1 ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å forecast_tomorrow.csv
#   ‚úÖ Verify forecasts ‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï performance_log.csv
#   ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á daily_forecast_summary_YYYY-MM-DD.csv

# STEP 2: ‡∏î‡∏π‡∏ú‡∏• Forward Testing (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å performance_log.csv)
python scripts/check_forward_testing.py
#   üìä ‡πÅ‡∏™‡∏î‡∏á PENDING, VERIFIED, Accuracy by Symbol/Pattern

# STEP 3: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Forward Testing ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (by exchange, by direction)
python scripts/forward_testing_report.py
#   üìã ‡πÅ‡∏™‡∏î‡∏á Accuracy ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î, ‡πÅ‡∏¢‡∏Å UP/DOWN, Top 10 Move%

# STEP 4: ‡∏™‡∏£‡∏∏‡∏õ Performance (Win Rate, RRR per stock)
python scripts/calculate_performance.py
#   üìà ‡πÅ‡∏™‡∏î‡∏á Market Summary + Per-Stock Precision

# STEP 5: ‡∏î‡∏π Dashboard ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å performance_log.csv)
python scripts/daily_forecast_dashboard.py
#   üì∫ ‡πÅ‡∏™‡∏î‡∏á Tomorrow's Forecasts, Accuracy Report, Summary
```

### üîß Maintenance (Run Order ‚Äî **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô**)

| ‡∏•‡∏≥‡∏î‡∏±‡∏ö | ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á | ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà | ‡πÄ‡∏ß‡∏•‡∏≤ |
|:-----:|--------|-----------|------|
| **M1** | `python scripts/generate_master_stats.py` | ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô engine logic | ~20-30 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **M2** | `python scripts/backfill_forward_testing.py --start-date YYYY-MM-DD` | ‡∏´‡∏•‡∏±‡∏á reset log ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ backfill | ~5-10 ‡∏ô‡∏≤‡∏ó‡∏µ |
| **M3** | `python main.py` | ‡∏´‡∏•‡∏±‡∏á maintenance ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á | ~5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

```bash
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üîß MAINTENANCE ‚Äî ‡∏£‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# M1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Master Stats ‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô engine logic)
python scripts/generate_master_stats.py
#   ‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ~20-30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 242 stocks

# M2: Backfill ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏´‡∏•‡∏±‡∏á reset log)
python scripts/backfill_forward_testing.py --start-date 2026-02-12

# M3: ‡∏£‡∏±‡∏ô prediction ‡πÉ‡∏´‡∏°‡πà
python main.py
```

### üÜï First Time Setup (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
```bash
# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ .env
echo TV_USERNAME=xxx > .env
echo TV_PASSWORD=xxx >> .env

# 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Master Stats (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ~20 ‡∏ô‡∏≤‡∏ó‡∏µ)
python scripts/generate_master_stats.py

# 3. (Optional) Backfill forward testing
python scripts/backfill_forward_testing.py --start-date 2026-02-12

# 4. ‡∏£‡∏±‡∏ô prediction ‡πÅ‡∏£‡∏Å
python main.py
```

---

## 10. Troubleshooting

### ‚ùå `FileNotFoundError: performance_log.csv`
**‡πÅ‡∏Å‡πâ:** ‡∏£‡∏±‡∏ô `python main.py` ‡∏Å‡πà‡∏≠‡∏ô ‚Äî ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### ‚ùå `tvDatafeed connection error`
**‡πÅ‡∏Å‡πâ:** ‡∏ï‡∏£‡∏ß‡∏à `.env` ‡∏ß‡πà‡∏≤‡∏°‡∏µ TV_USERNAME / TV_PASSWORD ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### ‚ùå `No patterns found for [STOCK]`
**‡πÅ‡∏Å‡πâ:** Stock ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (<300 bars) ‡∏´‡∏£‡∏∑‡∏≠ volatility ‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

### ‚ùå `Master stats not found`
**‡πÅ‡∏Å‡πâ:** ‡∏£‡∏±‡∏ô `python scripts/generate_master_stats.py` ‡∏Å‡πà‡∏≠‡∏ô

### ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á engine migration
**‡πÅ‡∏Å‡πâ:** Backup ‚Üí ‡∏•‡∏ö log ‡πÄ‡∏Å‡πà‡∏≤ ‚Üí Backfill ‡πÉ‡∏´‡∏°‡πà
```bash
# Backup
copy logs\performance_log.csv logs\performance_log_backup.csv

# ‡∏•‡∏ö
del logs\performance_log.csv

# Backfill
python scripts/backfill_forward_testing.py --start-date 2026-02-12

# ‡∏£‡∏±‡∏ô prediction ‡πÉ‡∏´‡∏°‡πà
python main.py
```
